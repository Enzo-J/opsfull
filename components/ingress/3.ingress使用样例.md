# 一、新应用http测试样例

## 1、关键三个点：

    注意这3个资源的namespace: kube-system需要一致

    Deployment

    Service

    Ingress

```
$ vim nginx-deployment-http.yaml

---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: nginx-pod
  namespace: kube-system
spec:
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx-pod
    spec:
      containers:
      - name: nginx
        image: nginx:1.15.5
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  namespace: kube-system
  annotations:
    traefik.ingress.kubernetes.io/load-balancer-method: drr  #动态加权轮训调度
spec:
  template:
    metadata:
      labels:
        name: nginx-service
spec:
  selector:
    app: nginx-pod
  ports:
  - port: 80
    targetPort: 80
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: nginx-ingress
  namespace: kube-system
  annotations:
    kubernetes.io/ingress.class: traefik
spec:
  rules:
  - host: k8s.nginx.com
    http:
      paths:
      - backend:
          serviceName: nginx-service
          servicePort: 80
```

## 2、创建资源

```
$ kubectl apply -f nginx-deployment-http.yaml

deployment.apps/nginx-pod create
service/nginx-service create
ingress.extensions/nginx-ingress create
```

## 3、访问刚创建的资源

首先这里需要先找到traefik-ingress pod 分布到到了那个节点，这里我们发现是落在了10.199.1.159的节点，然后我们绑定该节点对应的公网IP，这里假设为16.21.26.139

16.21.26.139 k8s.nginx.com

```
$ kubectl get pod -A -o wide|grep traefik-ingress
kube-system   traefik-ingress-controller-7d454d7c68-8qpjq   1/1     Running   0          21h   10.46.2.10    10.199.1.159   <none>           <none>
```

  ![ingress测试示例1](https://github.com/Lancger/opsfull/blob/master/images/ingress-k8s-01.png)



参考资料：

https://xuchao918.github.io/2019/03/01/Kubernetes-traefik-ingress%E4%BD%BF%E7%94%A8/  Kubernetes traefik ingress使用
